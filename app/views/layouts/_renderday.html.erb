<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v6.0"></script>



<% # This is to test the current page and next page. Still bug where it leave the page and goes to home page %>
<%= will_paginate @events, renderer: BootstrapPagination::Rails %>







<% offset = -1 * Time.now.in_time_zone("Pacific Time (US & Canada)").gmt_offset/3600%>
<% i = 0 %>
<% j = 0 %>
<% k = 0 %>
<% l = 0 %>




<div class="container" style="padding-top: 50px; float: center; width: auto; max-width: 1470px;">
<span class="more">
  <% if @events.count != 0 %>
    <table class="table table-hover" id=calendar>
      <tbody>
        <% @events.sort_by{|t| t.start_at}.each do |event| %>

            <% if event.start_at.to_date.eql?(@passingdaytodayy ) %>



        <% user = User.find(event.usrid) %>
        <% i += 1 %>
        <tr>
                  <td class=col-xs-3>
                    <% rsvpeople = "Join us!" %>
                    <% rsvpusers = event.users %>
                    <% if rsvpusers.count > 0 %>
                      <% rsvpusers.each do |rsvpuser| %>
                        <% rsvpeople = rsvpeople + ", " + rsvpuser.name %>
                      <% end %>
                    <% end %>
                    <%= link_to user.name, user.permalink, id: "calendar-event", title: rsvpeople %>

                    Let's talk about <%= link_to event.name, event, title: event.desc %>
                    <% if user_signed_in? %>
                      <% if event.usrid == current_user.id %>
                        <%= link_to '(Edit Conversation)', edit_event_path(event.id), id: "calendar-host" %>
                      <% end %>
                    <% end %>
                  </td>
                  <td class=col-xs-2>
                    <% edt = event.start_at + 3.hours %>
                    <span style="font-size:125%;" id=calendar-time-day<%=i%>></span>
                    <br>
                    <span style="font-size:90%;"id=calendar-time<%=i%>></span>
                  </td>
                  <script>
                    var date = new Date(Date.parse("<%= event.start_at.strftime("%FT%T%:z") %>"));
                    date.setHours(date.getHours() + parseInt("<%=offset%>")) // the 7 is for daylight savings time
                    var optionsDay = { weekday: 'short', month: 'long', day: 'numeric' };
                    var optionsTime = { hour: '2-digit', minute: '2-digit', timeZoneName: 'long'};
                    document.getElementById('calendar-time-day<%=i%>').innerHTML = date.toLocaleString(undefined, optionsDay);
                    document.getElementById('calendar-time<%=i%>').innerHTML = date.toLocaleString(undefined, optionsTime);
                  </script>
                  <td class=col-xs-3>
                    <%= rsvpeople %>
                  </td>
                  <td class=col-xs-2>
                    <% @rsvp = Rsvpq.new %>
                    <% start_time = event.start_at.strftime("%B %d %Y") + ' ' + event.start_at.strftime("%T") %>
                    <% end_time = event.end_at.strftime("%B %d %Y") + ' ' + event.end_at.strftime("%T") %>

                    <% if ((Time.current - offset.hours) > Time.find_zone("UTC").parse(start_time) ) && ((Time.current - offset.hours) < Time.find_zone("UTC").parse(end_time)) %>
                      <%= link_to " Join Conversation NOW ", "https://thinQtv.herokuapp.com/" + user.permalink, class: "btn btn-primary btn-sm fa fa-video-camera" %>

                    <% else %>
                        <%= form_for(@rsvp) do |f| %>
                          <% if @rsvp.errors.any? %>
                            <div id="error_explanation">
                              <h2><%= pluralize(@rsvp.errors.count, "error") %> prohibited this rsvp from being saved:</h2>
                              <ul>
                                <% @rsvp.errors.full_messages.each do |msg| %>
                                  <li><%= msg %></li>
                                <% end %>
                              </ul>
                            </div>
                          <% end %>
                          <input type="hidden" id="timeZone<%=i%>" name="timeZone">
                          <%= f.hidden_field :event_id, :value => event.id %>
                          <script>
                            var date = new Date(Date.parse("<%= event.start_at.strftime("%FT%T%:z") %>"))
                            date.setHours(date.getHours() + parseInt("<%=offset%>"))
                            var optionsTime = { hour: '2-digit', minute: '2-digit'};
                            document.getElementById("timeZone<%=i%>").value = date.toLocaleString(undefined, optionsTime)
                          </script>
                          <% if user_signed_in? %>
                            <%= f.hidden_field :user_id, :value => current_user.id %>
                            <%= f.submit "RSVP", :style => "color: #fff; background-color: #880f42; padding: 2px 20px; font-weight: normal; border-radius:0px; margin-left: 95px", :id => "RSVPsubmit" %>
                          <% else %>
                            <%= f.text_field :email, :style => "border: 1px solid grey; border-radius: 0px;", placeholder: "Enter email", :class =>"enter_email" %>
                            <%= f.submit "RSVP", :style => "color: #fff; background-color: #880f42; padding: 2px 20px; font-weight: normal; border-radius:0px;", :id => "RSVPsubmit" %>
                          <% end %>
                        <% end %>
                    <% end %>
                  </td>
                </tr>

        <% end %>

        <% end %>
      </tbody>
    </table>
  <% end %>
  </span>

</div>
